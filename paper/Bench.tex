\section{Evaluating the library \label{bench}}

The complete library with the corresponding contribution for prime numbers is available at \url{http://gforge.inria.fr/projects/coqprime/}. It consits in 9000 lines of hand-written
definitions and proofs. The automatically generated {\tt word8} arithmetic is much bigger,
95 Mb: 41 Mb is used to define functions and 54 Mb for the proofs. This is the largest ever
contribution that has been verified by {\sc Coq}. With this new library, we have been capable to
prove $2^{44497} - 1$ was prime using {\sc Coq}. As far as we know, it is the largest 
prime number  that has been certified by a theorem prover.

Even for small numbers, the {\sc Coq} version of our library is much more efficient than
the standard one. This is illustrated by Figure~\ref{fig:TimeCompW} and by the fifth and sixth  
columns of Figure~\ref{fig:Mersenne}. There is a maximum speed-up of 90. Our library makes it 
really possible to compute with large numbers inside {\sc Coq}.
\begin{figure}
\begin{center}
\begin{tabular}{|l|r| r|r|}
\hline
 & ~digits~ & ~postive~ & ~word8~ \\
\hline
~1234567891       ~  & 10~  & 0.50s~  & 0.10s~  \\
~74747474747474747~  & 17~ & 0.56s~  & 0.12s~  \\
~1111111111111111111~ & 19~ & 0.66s~ & 0.20s~  \\
~$(2^{148}+1)/17$ ~   & 44~ & 2.77s~  & 0.36s~  \\
~$P_{150}$   ~       & 150~ & 75.62s~  & 8.44s~  \\
\hline
\end{tabular}
\end{center}
\caption{Some verifications of certificates with the standard and our {\sc Coq} arithmetics}
\label{fig:TimeCompW}
\end{figure} 
\begin{figure}
\begin{center}
\begin{tabular}{|r|r|r|r|r|r|r|r|r |}
\hline
\# & n & digits & years &  positive & word8 & w31 & w64 & Big\_int\\
\hline
12 &  127 &  39 & 1876 &  0.73s & 0.04s & 0.01s & 0.s & 0.s \\
13 &  521 & 157 & 1952 &  53.00s & 1.85s & 0.02s & 0.02s &  0.s\\
14 &  607 & 183 & 1952 &  84.00s & 2.78s & 0.03s & 0.03s &  0.s\\
15 & 1279 & 386 & 1952 &  827.00s & 20.21s& 0.25s & 0.16s &  0.02s\\
16 & 2203 & 664 & 1952 &  4421.00s & 89.1s & 1.1s & 0.8s &  0.08s\\
17 & 2281 & 687 & 1952 &  4964.00s & 97.59s & 1.21s & 0.82s &  0.09s\\
18 & 3217 & 969 & 1957 &  14680.00s & 237.65s & 2.85s & 2.14s &  0.22s\\
19 & 4253 & 1281 & 1961 &35198.00s & 494.09s& 6.4s & 4.58s &  0.6s\\
20 & 4423 & 1332 & 1961 &  39766.00s & 563.27s & 6.99s & 4.99s &  0.67s\\
21 & 9689 & 2917  & 1963 &   & 5304.08s & 56.1s & 39.98s &  5.89s\\	 
22 & 9941 & 2993  & 1963 &   & 5650.63s & 60.5s & 42.53s &  6.32s\\	 
23 & 11213 & 3376 & 1963 &    & 7607.00s & 80.56s & 57.47s &  11.25s\\ 
24 & 19937 & 6002  & 1971 &  & 34653.12s & 377.24s & 268.09s &  45.75s\\
25 & 21701 & 6533 & 1978 &  &43746.21s & 463.02s & 338.04s &  58.56s \\
26 & 23209 & 6987 & 1979  &  &51210.56s & 538.33s & 403.48s &  88.43s\\
27 & 44497 & 13395 & 1979  &  &282784.09s & 3282.23s & 2208.45s &  476.75s \\
\hline

\end{tabular}
\end{center}
\caption{Time to verify Mersenne numbers}
\label{fig:Mersenne}
\end{figure}

Comparing {\tt word8} with the 31 bit {\sc Ocaml} integer {\tt w31} shows all the benefit we would
get from having machine words in {\sc Coq}. There is a maximum speed-up of 80 with respect to {\tt word8}. This
means a speed-up of 7200 with respect to the standard {\sc Coq} library.

The 64 bit {\sc Ocaml} integer {\tt w64} is a simulated arithmetic (our processor has only 32 bit).
This is why there is not such a gap between {\tt w31} and {\tt w64}. {\sc Big\_int}~\cite{bignum} is the  
standard exact library for {\sc Ocaml}. It has a purely functional interface but 
is written in C. The comparison is not bad. We are only 6 time slower. It is also very interesting
that this gap is getting smaller as numbers get larger. Random tests on addition gives a factor of
4, multiplications a factor of 10.

We are still far away from getting the performance of the {\sc gmp}~\cite{GMP} library. This library is written in
C and uses inplace computation instead. This minimizes considerably the number of memory allocations.
Unfortunately, inplace computation is not compatible with the logic of {\sc Coq}.

